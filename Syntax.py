from Token import token_num

automata = [
    [-1,-2,-3,-4,-24,16,10,26,0,-5,-6,1,1,2,-7,-13,-10,14,-38,-11,-8],#0
    [-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,2,-9,-9,-9,-39,-9,-9],
    [-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,2,-12,3,3,-40,4,-12],
    [-13,2,6,5,-13,-13,-13,-13,-13,-13,-13,-13,-13,-13,2,0,-13,-13,-41,-13,-13],
    [-14,-14,6,5,-14,-14,-14,-14,-14,-14,-14,-14,-14,-14,-14,-14,-14,-14,-42,-14,-14],
    [-15,-15,-15,-15,-15,-15,-15,-15,-15,-15,-15,-15,-15,-15,-15,-15,-15,4,-43,4,-15],#5
    [-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,6,-16,7,7,-44,8,-16],
    [-17,2,-17,9,-17,-17,-17,-17,-17,-17,-17,-17,-17,-17,-17,0,-17,-17,-45,-17,-17],
    [-18,2,-18,9,-18,-18,-18,-18,-18,-18,-18,-18,-18,-18,-18,0,-18,-18,-46,-18,-18],
    [-19,-19,-19,-19,-19,-19,-19,-19,-19,-19,-19,-19,-19,-19,9,-19,-19,8,-47,8,-19],
    [-20,-20,-20,-20,-20,-20,-20,-20,-20,-20,-20,-20,-20,-20,-20,-20,-20,11,-48,-20,-20],#10
    [-21,-21,-21,-21,-21,-21,-21,-21,0,10,12,-21,-21,-21,-21,-21,-21,-21,-49,-21,-21],
    [-22,-22,-22,-22,-22,-22,-22,-22,-22,-22,-22,-22,-22,12,12,-22,-22,13,-50,13,-22],
    [-23,-23,-23,12,-23,-23,-23,-23,0,-23,-23,-23,-23,-23,-23,13,-23,-23,-51,-23,-23],
    [-24,-24,-24,-24,15,-24,-24,-24,-24,-24,12,-24,-24,-24,-24,-24,-24,-24,-52,-24,-24],
    [-25,-25,-25,-25,-25,-25,-25,-25,0,-25,-25,-25,-25,-25,-25,-25,-25,-25,-53,-25,-25],#15
    [-26,-26,-26,-26,-26,-26,-26,-26,-26,-26,-26,-26,-26,-26,-26,-26,-26,17,-54,-26,-26],
    [-27,-27,-27,-27,-27,-27,-27,-27,0,16,18,-27,-27,-27,-27,-27,-27,-27,-55,-27,-27],
    [-28,-28,-28,-28,-28,-28,-28,-28,-28,-28,-28,-28,-28,-28,18,-28,-28,19,-56,20,-28],
    [-29,-29,22,21,-29,-29,-29,-29,0,-29,-29,-29,-29,-29,-29,-29,-29,-29,-57,-29,-29],
    [-30,-30,22,21,-30,-30,-30,-30,-30,-30,-30,-30,-30,-30,-30,20,-30,-30,-58,-30,-30],#20
    [-31,-31,-31,-31,-31,-31,-31,-31,-31,-31,-31,-31,-31,-31,21,-31,-31,20,-59,20,-31],
    [-32,-32,-32,-32,-32,-32,-32,-32,-32,-32,-32,-32,-32,-32,22,-32,-32,23,-60,24,-32],
    [-33,18,-33,25,-33,-33,-33,-33,0,-33,-33,-33,-33,-33,-33,23,-33,-33,-61,-33,-33],
    [-34,18,-34,25,-34,-34,-34,-34,0,-34,-34,-34,-34,-34,-34,24,-34,-34,-62,-34,-34],
    [-67,-67,-67,-67,-67,-67,-67,-67,-67,-67,-67,-67,-67,-67,25,-67,-67,24,-67,24,-67],#25
    [-35,-35,-35,-35,-35,-35,-35,-35,-35,-35,-35,-35,-35,-35,-35,-35,-35,27,-63,-35,-35],
    [-36,-36,-36,-36,-36,-36,-36,-36,-36,26,29,-36,-36,-36,-36,-36,-36,-36,-64,-36,-36],
    [-37,-37,-37,-37,-37,-37,-37,-37,0,-37,-37,-37,-37,-37,-37,-37,-37,-37,-65,-37,-37],
    [-66,-66,-66,-66,-66,-66,-66,-66,-66,-66,-66,-66,-66,-66,-66,-66,-66,-66,28,-66,-66]
    # [p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p],
]

def check_syntax(input_file,if_func = False,j = None,ind = None,end_if = None):
    current_state = 0
    if_counter = 0
    if_boolean = False
    if_func_tmp = if_func
    while_boolean = False
    list = [line for line in input_file]
    line_numbers = len(list)
    i = 0
    if j != None:
        i=j
    while(i < line_numbers):
        tmp_list = enumerate(list[i].replace('\t', ' ').split(' '))
        if if_func_tmp:
            tmp_list = enumerate(list[i].replace('\t',' ').split(' ')[ind:])
            if_func_tmp = False
            if_boolean = False
        for index,token in tmp_list:
            current_state = automata[current_state][token_num(token.strip())]
            if if_func and token.strip() == end_if:
                return i,index
            if if_boolean:
                print(token.strip())
                if token.strip() == '(':
                    if_counter += 1
                elif token.strip() == ')':
                    if_counter -= 1
                if if_counter == 0:
                    if (len(list[i].replace('\t',' ').replace('\n','').split(' '))>index+1 and list[i].replace('\t',' ').replace('\n','').split(' ')[index+1] == '{') or (len(list)>=i+1 and list[i+1].replace('\t',' ').replace('\n','').split(' ')[0] == '{'):
                        check_syntax(input_file,if_func=True,j=i,ind = index,end_if = '}')
                    else :
                        check_syntax(input_file,if_func=True,j=i, ind=index, end_if=';')
            if current_state == 1:
                if token.strip() == 'if':
                    if_boolean = True
                else :
                    while_boolean = True
        i += 1
